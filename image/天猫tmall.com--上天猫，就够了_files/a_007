KISSY.add("mui/searchbar/instance/default",function(e,a,r,t,i,s,o,n,u,c,l,m,h,p,d){var g=window,b=g.g_config||{},f=b["bizId"]||"",v=b["sysId"]||"",C=b["devId"]||"pc",w=f+"."+v+"."+C,x="//suggest.taobao.com/sug?area=tmall-hq&code=utf-8&src="+w,q=(new p).getCurBt();window._CTK3417=window._CTK3417||function(){var e={},a="",r=0;function t(e){var a=0,r,t,i;if(e.length===0)return a;for(r=0,i=e.length;r<i;r++){t=e.charCodeAt(r);a=(a<<5)-a+t;a|=0}return a}return function(i,s,o,n){n=n||{};if(n.reject){if(typeof n.reject!="object"){n.reject=[n.reject]}for(var u=n.reject.length-1;u>=0;u--){if(e[n.reject[u]]){return}}}if(!a){a=s}var c=(new Date).valueOf();e[s]=c;var l;if(s==a){var m=window.g_config&&g_config.startTime;l=m?c-m:0}else{l=c-(e[o||a]||e[a])}switch(n.autoGroup){case"time":n.group=n.autoGroup+"_"+(l<=0?0:Math.floor(Math.log(l)/Math.log(2)));break}if(typeof i=="object"){i=i[n.group||"_"]||Math.round(Math.log((undefined||8192)/(undefined||1/16))/Math.log(2))}var h=null,p=h&&h[Math.floor((c+288e5)/(864e5/144))%144]||1,d=Math.round(Math.max(Math.pow(2,i)*p/(undefined||8192),1));if(Math.floor(Math.random()*d)>0){return}function g(e,a){var i="undefined"+r++,s=window[i]=new Image;s.onload=s.onerror=function(){window[i]=null};var o=["type="+encodeURIComponent(n.type||"normal"),"name="+encodeURIComponent(e),"parent="+encodeURIComponent(a||""),"module="+encodeURIComponent(n.dataId||"30"),"msg="+encodeURIComponent(n.msg||""),"version="+encodeURIComponent("3.3.28"),"sample="+d,"time="+(l>0?l:0)].join("&");s.src="//gm.mmstat.com/tmjs.1.1?"+o+"&hash="+t(o)}if(n.group){g(s+"|"+n.group,s)}g(s,o)}}();_CTK3417(30,"codetrack.init");var y={build:function(e){e=e||{};var p=e.node||"#mq",g=!!e.autoFocus,f=e.clickId,v=e.pageType,C=!!e.unableSpeech,y=e.placeholder||{},A=e.query||t.UNKNOWN,S=e.extraParams,k=e.sugArea||"b2c",B=e.tag||"",I=false,_="//suggest.taobao.com/sug?area="+k+"&code=utf-8"+(B?"&tag="+B:"")+"&k=1&bucketid="+q+"&src=tmall_pc";var T=b.searchbarCfg=b.searchbarCfg||{},M=!!T.isTestBt;if(M){_=_.replace(/\barea=b2c\b/gi,"area=b2c_bts")}var E=a.one(p),N=E?E.parent("form"):undefined,U=N?N[0].redirect:undefined,j=U?U.value:"";var D=new s({text:y.text||"\u641c\u7d22 \u5929\u732b \u5546\u54c1/\u54c1\u724c/\u5e97\u94fa",query:y.query||"",redirectUrl:y.redirectUrl||j});if(TB&&TB.globalToolFn&&TB.globalToolFn.requestHotQuery){TB.globalToolFn.requestHotQuery(function(e){if(e.success&&e.model&&e.model.placeholder){D.update(e.model.placeholder[0])}else{D.update(e)}})}else{r({url:y.cfgTMSUrl||x||"//www.tmall.com/go/rgn/tmall/searchbar/placeholder-reader.php",success:function(e){if(e.success&&e.model&&e.model.placeholder){D.update(e.model.placeholder[0])}else{D.update(e)}},scriptCharset:"utf-8",dataType:"jsonp"})}var P=new t({plugins:[D,new i({}),new o({type:"20151212"})],sugConfig:{url:_,node:p||"#mq",autoFocus:!!g,autoExpand:true,extraParams:S||{},enableSpeech:!C},templates:{act:n,meetingPlace:d,shipShop:u,cat:c,list:l,shop:m,quickSearch:h},query:A,acceptCharset:"gbk",dim:w,log:{pageType:v||1,clickId:f||"topsearch",isMobile:false}});_CTK3417(30,"app.init");_CTK3417(30,"default","app.init",{group:location.hostname});E.on("valuechange",function(){try{var e;if(window.performance&&window.performance.timing){e=Date.now()-window.performance.timing.loadEventEnd;if(e<=5e3&&!I){_CTK3417(30,"default.focus3S","app.init",{group:location.hostname});I=true}}}catch(a){}});return P}};return y},{requires:["node","ajax","mui/searchbar/base","mui/searchbar/plugin/spm","mui/searchbar/plugin/placeholder","mui/searchbar/plugin/hubaccess","mui/searchbar/template/act","mui/searchbar/template/shipShop","mui/searchbar/template/cat","mui/searchbar/template/list","mui/searchbar/template/shop","mui/searchbar/template/quickSearch","mui/bucket/index","mui/searchbar/template/meetingPlace","mui/searchbar/suggest.css"]});KISSY.version>=1.4&&KISSY.config({modules:{sizzle:{alias:["node"]},"rich-base":{alias:["base"]},ajax:{alias:["io"]}}});KISSY.add("mui/searchbar/base",function(S,Node,RichBase,D,ComboBox,UA,Cookie,E,IO){var TIP="\u8bf7\u8f93\u5165\u641c\u7d22\u6587\u5b57",UNKNOWN="unknown",VALUE="{VALUE}",ltIE9=UA.ie<9,win=window;function makeCacheNum(){return Math.floor(Math.random()*268435456).toString(16)}var SearchBar=RichBase.extend([],{initializer:function(){this._initComboxBox();this._bindSubmitEvent();this._other();this._loadConfig()},_initComboxBox:function(){var e=this,a=e._buildDataSourceCfg(),t=new ComboBox.RemoteDataSource(a),r=e._buildComboBoxCfg(t),i=e.comboBox=new ComboBox(r);var s=i.sendRequest;i.sendRequest=function(a){a=S.trim(a);if(e.fire("beforeQueryChange",{query:a})!==false){s.call(this,a)}};i.normalizeData=function(e){var a=this,t;if(a.get("format")){t=a.get("format").call(a,(a["getValueInternal"]||a["getValueForAutocomplete"]).call(a),e)}else{t=[]}return t.slice(0,a.get("maxItemCount"))};i.render();e._bindComboBoxEvents()},_buildDataSourceCfg:function(){var e=this.get("sugConfig"),a=this.get("dataSourceCfg");a.xhrCfg.url=e.url;a.parse=S.bind(this._parse,this);return a},_parse:function(e,a){var t=this.fire("beforeParse",{data:a,query:e});if(t===false){return null}else if(t){a=t}return a},_bindComboBoxEvents:function(){var e=this,a=this.get("templates"),t=this.get("log"),r=function(r){var i=D.children(r),s=D.attr(i,"data-tpl"),n=a[s],o=S.unparam(D.attr(i,"data-params")||""),u=S.merge(e.get("options"),{$query:S.escapeHTML(e.curQuery),$pageType:t.pageType,$index:D.attr(i,"data-index")||"1",$isMobile:t.isMobile});n&&e.clicklog((n["genAtpanel"]||function(e,a){return S.substitute(n.atpanel,a)})(i,S.merge(u,o)))};this.comboBox.on("click",function(a){var t=a.target;if(/MyIE/i.test(navigator.userAgent)){if(!a._elItem)return;else{t.set("el",a._elItem)}}if(t&&t.get("el")&&t.get("el")[0]&&D.get(".s-mi-ship",t.get("el")[0])){r(t.get("el"));location.href=D.attr(D.get(".s-mi-ship .s-mi-ship-wrap",t.get("el")[0]),"data-url");return}if(t&&(t.get("el").hasClass(".s-hqHd-menuitem")||t.get("el").hasClass(".s-hyHd-menuitem")||t.get("el").hasClass(".s-loginHd-menuitem"))){return}if(t&&t.get("el")[0]&&D.get(".s-mi-meetingPC",t.get("el")[0])){return}if(e.fire("itemClick",{activeitem:t})!==false){var i=this.get("form"),s=t.get("el");var n=D.attr(D.children(s),"data-params")||"q="+e.query;n=S.merge(this.get("sugConfig").extraParams,S.unparam(n));this.filterFormParams(n);r(s);i.fire("submit",{ignoreClicklog:1})}},this)},filterFormParams:function(e){var a=new RegExp("windows phone|windowsphone","i");var t=navigator.userAgent||"";var r,i,s,n;if(!a.test(t)){for(r=0,i=this.get("form")[0],s=i.elements,n=s.length;r<n;r++){s[r].type==="hidden"&&s[r].name&&D.attr(s[r],"disabled","disabled")}}this.modifyFormParams(e,1)},modifyFormParams:function(params,forceEnable){var form=this.get("form")[0];for(var k in params){if(!params.hasOwnProperty(k)){continue}params[k]=params[k]||"";if(form[k]&&form[k].tagName==="INPUT"){if(params[k].indexOf(VALUE)>-1){if(params[k]!==VALUE){D.val(form[k],eval(params[k].replace(VALUE,form[k].value)))}}else{D.val(form[k],params[k])}Node.one(form[k]).fire("valuechange");forceEnable==1&&D.removeAttr(form[k],"disabled")}else{var value=params[k];if(params[k].indexOf(VALUE)>-1){if(params[k]!==VALUE){value=eval(params[k].replace(VALUE,""))}else{value=""}}D.append(D.create('<input type="hidden" name="'+k+'" value="'+S.escapeHTML(value)+'"/>'),form)}}},_bindSubmitEvent:function(){var e=this,a=e.get("form"),t=e.get("input"),r=e.get("button"),i=e.get("dim"),s=e.get("log"),n=e.get("sugConfig").extraParams,o=e.get("acceptCharset");a.on("submit",function(a){var r=e.fire("beforeSubmit");if(r===false){a.halt()}if(!a.ignoreClicklog&&r!==e.IGNORE_CLICK_LOG){e.clicklog(","+t.val()+","+t.val()+","+i+"-,"+s.clickId+",searchbutton,"+s.pageType+","+s.isMobile)}UA&&UA.ie&&o!==UNKNOWN&&(document.charset=o)});function u(){e.filterFormParams(S.merge(n,{type:"p",q:VALUE,from:i+"_1_searchbutton"}))}t.on("keydown",function(e){if(e.keyCode==13){var t=new RegExp("windows phone|windowsphone","i");var r=navigator.userAgent||"";if(t.test(r)){e.preventDefault();E.fire(a,"submit")}else{u()}}});r.on("click",function(e){u()})},_buildComboBoxCfg:function(e){var a=this.get("sugConfig");return{srcNode:this._wrapInput(a.node,a.prefixCls)||"."+a.prefixCls+"combobox",dataSource:e,format:S.bind(this._format,this),focused:!!a.autoFocus,prefixCls:a.prefixCls||"ks-",hasTrigger:false,matchElWidth:!!a.matchElWidth,highlightMatchItem:false,menu:{align:{overflow:{adjustY:0}}},cache:true,placeholder:a.placeholder||TIP}},_wrapInput:function(e,a){var t=this.get("sugConfig"),r=t.enableSpeech;D.attr(e,S.merge({"class":a+"combobox-input",autocomplete:"off",role:"combobox","aria-haspopup":"true",title:TIP,"aria-label":TIP},r?{"x-webkit-speech":"","x-webkit-grammar":"builtin:translate"}:{}));var i=D.parent(e,".{cls}combobox".replace(/{cls}/g,a)),s=S.guid(a+"combobox-"),n;if(i){i.id=i.id||s;n=Node.one(i)}else{D.wrap(e,D.create('<div id="'+s+'" class="{cls}combobox"><div class="{cls}combobox-input-wrap"></div></div>'.replace(/{cls}/g,a)));n=Node.one("#"+s)}return n},_loadConfig:function(){var e=this;S.ready(function(){setTimeout(function(){IO({url:"//pages.tmall.com/wow/list/act/search-act",dataType:"jsonp",scriptCharset:"utf-8",jsonpCallback:"Jsonp_fixed_searchbar_act",success:function(a){var t=e.get("templates").act;if(t){t.text=a.text||"";t.promo=typeof a.promo=="undefined"?"49218":a.promo}e&&e.fire("configInit",{data:a})}})},0)});return true},_format:function(e,a){if(!a)return[];var t=this.get("templates"),r=this.get("dim"),i=[],s=this._getDate(),n=this.get("sugConfig").prefixCls,o={$wq:S.escapeHTML(e),$query:S.escapeHTML(e),$index:0,$date:s,$prefixCls:n,$dim:r,$userId:a["shop_info"]&&a["shop_info"][0]&&a["shop_info"][0]["user_id"]||""};this.set("options",o);for(var u in t){if(!t[u]){delete t[u];continue}S.log("searchbar::to parse template:"+u+"...");t[u].parse(i,a,S.clone(o))}return i},_getDate:function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+(e.getDate()+1)},update:function(e){var a=this.get("plugins");for(var t=0,r=a.length,i;t<r;t++){i=a[t];i&&S.isFunction(i.update)&&i.update(e)}},blur:function(){var e=this.get("input");e[0].blur()},clicklog:function(e){var a=e.split(","),t=win.__header_atpanel_param||"",r={pos:a[0]||"",q:a[1]||"",wq:a[2]||"",suggest:a[3]||"",clickid:a[4]||"",combo:a[5]||"",page_type:a[6]||"",is_wap:a[7]||"0",type:a[8]||5,active:"0",search_type:"search"};t+=(S.endsWith(t,"&")?"":t?"&":"")+S.param(r);this.exposelog("/mallsearch","tmallsearch",t,"H1449172242")},exposelog:function(e,a,t,r){if(win.goldlog&&win.goldlog.record){goldlog.record(e,a,t,r)}else{var i=new Image,s="_img_"+e+"_"+(new Date).getTime();win[s]=i;i.onload=i.onerror=function(){win[s]=null};i.src="//gm.mmstat.com"+e+"?goldlog=undefined"+"&cache="+makeCacheNum()+"&gmkey="+encodeURIComponent(a)+"&gokey="+encodeURIComponent(t)+"&cna="+(Cookie.get("cna")||"");S.log(win[s]);i=null}},_other:function(){var e=this,a=this.get("ignoreChars"),t=new RegExp("["+a.join(",")+"]","gi"),r=this.get("input"),i=this.comboBox,s=this.get("sugConfig"),n=s.autoExpand,o=s.prefixCls;var u=this.get("query");if(u!==UNKNOWN){r.attr("value",u);i.set("value",u)}r.on("keyup",function(e){e.shiftKey&&(e.keyCode<37&&e.keyCode!==16||e.keyCode>40)&&(this.value=this.value.replace(t,""))});n&&r.on("focus",function(){i.sendRequest(S.trim(this.value))});Node.one(window).on("resize",S.buffer(function(a){var t=e.get("menuContainer");t&&t.width(r.outerWidth())},150));var c=this.get("acceptCharset"),l=this.get("form");c!==UNKNOWN&&l.attr("accept-charset",c);var m=s["autoSubmitOnItemClick"];!m&&this.on("itemClick",function(){return false});i.on("afterCollapsedChange",function(a){if(!a.newVal){i.detach("afterCollapsedChange",arguments.callee);if(/MyIE/i.test(navigator.userAgent)){E.delegate(D.get(".s-menu"),"click",".s-menuitem",function(a){e.comboBox.fire("click",{_elItem:S.one(a.currentTarget)})})}}});r.on("valuechange",function(){e.curQuery=r.val()});e.curQuery=r.val()},_event:["beforeSubmit","beforeParse","beforeQueryChange","itemClick","restore","configInit"],VALUE:VALUE,IGNORE_CLICK_LOG:"{{ignore_click_log}}",UNKNOWN:UNKNOWN},{ATTRS:{sugConfig:{value:{extraParams:{},url:"",node:"",autoFocus:false,autoExpand:false,prefixCls:"s-",placeholder:TIP,enableSpeech:true,matchElWidth:true,autoSubmitOnItemClick:true},setter:function(e){var a=this.get("sugConfig");return S.mix(a,e,undefined,undefined,true)}},templates:{value:{},setter:function(e){return e}},nodes:{value:{}},placeholder:{getter:function(){var e=this.get("nodes");if(!e.placeholder){e.placeholder=this.comboBox.get("placeholderEl")}return e.placeholder}},input:{getter:function(){var e=this.get("nodes");if(!e.input){e.input=this.comboBox.get("input")}return e.input}},button:{getter:function(){var e=this,a=this.get("nodes");if(typeof a.button==="undefined"){var t=this.get("form");var r=t[0].elements;S.each(r,function(a){if(D.attr(a,"type")==="submit"){e.get("nodes").button=Node.one(a)}})}!a.button&&S.log("searchbar::there isn't a button of 'submit' type in this form!","error");return a.button}},form:{getter:function(e){var a=this.get("nodes");if(!a.form){a.form=this.get("input").parent("form")}return a.form}},container:{getter:function(){var e=this.get("nodes");if(!e.container){e.container=this.comboBox.get("el")}return e.container}},menuContainer:{getter:function(){var e=this.get("nodes");if(!e.menuContainer){var a=this.get("menu");a&&a.get&&(e.menuContainer=a.get("el"))}!e.menuContainer&&S.log("searchbar::at so far, popup menu for suggest is nonexistent.","warn");return e.menuContainer}},menu:{getter:function(){return this.comboBox.get("menu")}},dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:true,paramName:"q",cache:true}},dim:{value:".list.pc"},log:{value:{pageType:"1",clickId:"topsearch",isMobile:0},setter:function(e){var a=this.get("log");a=S.mix(a,e,undefined,undefined,true);a.isMobile=a.isMobile?1:0;return a}},ignoreChars:{value:["<",">","?","\uff1f"]},acceptCharset:{value:UNKNOWN},query:{value:UNKNOWN,setter:function(e){if(e){var a=this.get("ignoreChars"),t=new RegExp("["+a.join(",")+"]","gi");e=e.replace(t,"")}else{e=""}return e}}}});SearchBar.UNKNOWN=UNKNOWN;SearchBar.VALUE=VALUE;SearchBar.IGNORE_CLICK_LOG="{{ignore_click_log}}";return SearchBar},{requires:["node","rich-base","dom","combobox","ua","cookie","event","io"]});KISSY.add("mui/searchbar/plugin/spm",function(e,t,a){var r="data-spm",i="spm-id",n="spm",o="0.0.a2227oh.d100";function s(t){s.superclass.constructor.call(this,e.merge({spm:o},t||{}))}e.extend(s,a,{pluginInitializer:function(e){this.set("caller",e);this.init()},init:function(){var e=this.get("caller");if(!e)return;var t=e.get("sugConfig").extraParams;t[n]=this.get("spm")}},{ATTRS:{pluginId:{value:"spm"},spm:{value:o,setter:function(e){var a=(e.split(".")||[]).reverse(),n={};n.d=a[0]||"0";n.c=a[1]||"0";n.b=a[2]||"0";n.a=a[3]||"0";var o=c(i),s=o?o.content:"";if(!s){o=c(r);s=o?o.content:"";s+="."+(t.attr(document.body,r)||"")}var u=s.split(".")||[];n.a=u[0]||n.a;n.b=u[1]||n.b;return[n.a,n.b,n.c,n.d].join(".")},getter:function(e){var t=(e.split(".")||[]).reverse(),a={};var i=this.get("caller");if(i){var o=i.get("form"),s=o[0][n],c;if(s&&s.tagName==="INPUT"){c=(s.value.split(".")||[]).reverse();t[0]=c[0]||t[0];t[1]=c[1]||t[1]}if(!t[1]&&a.c==="0"){var l=i.get("input"),m=i.get("container");t[1]=m.attr(r)||o.attr(r)||u(l[0])||t[1]}}return t.reverse().join(".")}}}});function u(e){var t;while(e&&e.tagName!="HTML"&&e.tagName!="BODY"&&e.getAttribute){if(t=e.getAttribute(r)){break}if(!(e=e.parentNode)){break}}return t}function c(e){try{return t.get('meta[name="'+e+'"]')}catch(a){var r=t.query("meta"),i="";for(var n=0,o=r.length;n<o;n++){if(r[n].name==e){i=r[n];break}}return i}}return s},{requires:["dom","base"]});KISSY.add("mui/searchbar/plugin/placeholder",function(e,t,a){var r=window;function i(e){this._tasks=[];i.superclass.constructor.call(this,e||{})}e.extend(i,a,{pluginInitializer:function(t){this.set("caller",t);var a=t.get("placeholder");if(!a){var r=this.get("text"),i=t.get("input"),n=t.get("container"),o=i.attr("id"),s=t.get("sugConfig").prefixCls;!o&&i.attr("id",o=e.guid(s+"combobox-input"));t.comboBox.set("placeholderEl",e.all('<label for="'+o+'" class="'+s+'combobox-placeholder">'+r+"</label>").appendTo(n))}this._customizeText();this._customizeInteraction();this._customizeSearch()},_customizeText:function(){var e=this.get("caller"),t=e.comboBox,a=t.get("placeholderEl"),r=this.get("text");a&&a.html(r);t.set("placeholder",r)},_customizeInteraction:function(){var t=this.get("caller"),a=t.get("placeholder"),r=t.get("input"),i=this.get("colors");function n(){e.trim(r.val())===""?a.css({visibility:"visible"}):a.css({display:"none",visibility:"hidden"})}setTimeout(n,100);r.on("valuechange",n);a.css("color",i[1]);if(t.get("sugConfig").autoFocus){a.css("color",i[0])}r.on("focus",function(){a.css("color",i[0]);e.trim(this.value)===""&&a.css({display:"inline",visibility:"visible"})});r.on("blur",function(){e.trim(this.value)===""&&e.trim(r.attr("value"))===""&&a.css({color:i[1],visibility:"visible"})});r.on("keydown",function(t){var r=t.keyCode;if(r==32&&e.trim(this.value)===""){a.css({visibility:"hidden"})}else if(r<13||r>37&&r<112||r>123){a.css({visibility:"hidden"})}});r.on("keyup",function(e){var t=e.keyCode;this.value===""&&!(t==8||t==46)&&a.css({display:"inline",visibility:"visible"})})},_customizeSearch:function(){var a=this,r=this.get("query"),i=this.get("text"),n=this.get("redirectUrl"),o=this.get("xiaoer"),s=this.get("caller"),u=s.get("input"),c=s.get("form"),l=s.get("dim"),h=s.get("log");if(r&&!this._eQueryFn){s.on("beforeSubmit",this._eQueryFn=function(t){if(e.trim(u.val())===""){u.val(a.get("query"));s.modifyFormParams({from:l+"_"+o+"_placeholder"});s.clicklog(","+a.get("query")+","+a.get("query")+","+l+"-,"+h.clickId+",placeholder,"+h.pageType+","+h.isMobile);setTimeout(function(){u.val("")},0);return s.IGNORE_CLICK_LOG}});setTimeout(function(){s.exposelog("/msearch.3.3","searchbar-placeholder","dim="+l+"&q="+r+"&xiaoer="+o,"H46777406")},0)}else if(!r&&this._eQueryFn){s.detach("beforeSubmit",this._eQueryFn);this._eQueryFn=null}if(!r){if(n&&!this._eRedirectFn){if(!c[0]["redirect"])c.append(t.create('<input type="hidden" name="redirect" value="" disabled="disabled" />'));s.on("beforeSubmit",this._eRedirectFn=function(a){if(e.trim(u.val())===""){c[0]["redirect"].value=n;t.removeAttr(c[0]["redirect"],"disabled");s.modifyFormParams({from:l+"_1_placeholder"});s.clicklog(","+n+","+n+","+l+"-,"+h.clickId+",placeholder,"+h.pageType+","+h.isMobile);return s.IGNORE_CLICK_LOG}else{c[0]["redirect"].value="";t.attr(c[0]["redirect"],"disabled","disabled")}});return}else if(!n&&this._eRedirectFn){s.detach("beforeSubmit",this._eRedirectFn);this._eRedirectFn=null}}else{if(this._eRedirectFn){s.detach("beforeSubmit",this._eRedirectFn);this._eRedirectFn=null}}!this._eEmptyFn&&s.on("beforeSubmit",this._eEmptyFn=function(t){if(a._eQueryFn||a._eRedirectFn){s.detach("beforeSubmit",a._eEmptyFn);a._eEmptyFn=null;return}if(e.trim(u.val())===""){a._emptyNotice();return false}})},_reviseUrl:function(e){var t=r.TB&&TB.globalToolFn&&TB.globalToolFn.isDaily&&TB.globalToolFn.isDaily(),a="?spm=0.0.0.0",i=e.indexOf("?"),n=e.indexOf("#"),o=n<0?e.length:n;t&&e.replace(/\b\/\/list.tmall.com\b/,"//list.daily.tmall.net");return i>0?e.replace("?",a+(i==o-1?"":"&")):e+a},_emptyNotice:function(){var e=this.get("caller"),t=e.get("placeholder"),a=e.get("input");if(!a._inFlash){a._inFlash=true;t.html("\u8bf7\u8f93\u5165\u5173\u952e\u5b57");t.css("visibility","visible");this._flashBackground()}},_flashBackground:function(){var a=this.get("caller"),r=a.get("input"),i={background:r.css("background"),borderLeftColor:r.css("border-left-color"),zIndex:r.css("z-index")};r.css({background:"none #fff",borderLeftColor:"#fdbd78",zIndex:e.UA.ie<8?-1:0});this._flashBackgroundAnim(r,4,function(){t.css(r,i);r._inFlash=false})},_flashBackgroundAnim:function(t,a,r){var i=this;if(a<=0){if(r){r.call()}return}new e.Anim(t,{backgroundColor:a%2==0?"#fdbd78":"#fff"},.3,"easeNone",function(){i._flashBackgroundAnim(t,--a,r)}).run()},renderPlugin:function(e){},update:function(e){if(!e||typeof e!=="object")return;if(!this.get("caller")){this._tasks.push(["update",arguments]);return}e.text&&this.set("text",e.text);e.query&&this.set("query",e.query);e.redirectUrl&&this.set("redirectUrl",e.redirectUrl);e.xiaoer&&this.set("xiaoer",e.xiaoer);this._customizeText();this._customizeSearch()}},{ATTRS:{pluginId:{value:"placeholder"},colors:{value:["#ccc","#666"]},text:{value:"\u641c\u7d22 \u5929\u732b \u5546\u54c1/\u54c1\u724c/\u5e97\u94fa",setter:function(e){return typeof e==="string"?e:"\u641c\u7d22 \u5929\u732b \u5546\u54c1/\u54c1\u724c/\u5e97\u94fa"}},query:{value:"",setter:function(e){return typeof e==="string"?e:""}},redirectUrl:{value:"",setter:function(e){return typeof e==="string"&&e!=="notRedirect"?e:""}},xiaoer:{value:0,setter:function(e){return e?1:0}},caller:{value:undefined,setter:function(e){if(e){var t=this;setTimeout(function(){var e=t._tasks;for(var a=0,r=e.length,i;a<r;a++){i=e.shift();t[i[0]].apply(t,i[1])}},10);return e}}}}});return i},{requires:["dom","base"]});KISSY.add("mui/searchbar/plugin/hubaccess",function(e,a,t,r,i,n){function o(a){o.superclass.constructor.call(this,e.merge(a||{}))}e.extend(o,t,{pluginInitializer:function(e){this.set("caller",e);this.init()},init:function(){var e=this.get("caller");if(!e)return;this.HUB_INSTANCE=null;this.HUB_SEARCH_SUBMIT=false;this.HUB_ENV=s();this.HUB_BRO=u();this.HUB_IS_ON_ZEBRA=false;var a=new i(location.href).getQuery().get("s");var t=new i(location.href).getQuery().get("jumpto");if(this.HUB_ENV&&this.HUB_BRO){if(!a&&!t){this.bindListener()}}},bindListener:function(){var e=this;var a=this.get("caller");a&&a.on("configInit",function(t){if(t&&t.data&&t.data.isHubOn){a.set("HUB_IS_ON_ZEBRA",true);e.initHub(t.data)}})},initHub:function(a){var t=this;var i=this.get("caller");var n=i.get("form"),o=i.get("input");var s,u="";_CTK3417(30,"hub.init");if(c()){s=a.version_2;u=[location.href,"###version:",s].join("")||"";_CTK3417(0,"error:hub.error","hub.init",{msg:"\u7ea2\u5305\u7ec4\u4ef6\u8c03\u8bd5\u5f00\u542f",group:u,type:"error"})}else{s=a.version_1}s=s||"1.6.8";if(s==="close"){return false}e.config({packages:{hbhub:{path:"//g.alicdn.com/mtb/app-hongbaohub/"+s+"/",version:s,ignorePackageNameInUri:true,charset:"utf-8",debug:true}}});e.use("hbhub/index",function(e,a){t.HUB_INSTANCE=a;var r="";if(t.HUB_ENV==="search"){r=o.val()}a.init(r)});i&&i.on("beforeSubmit",function(){var a=i.get("HUB_IS_ON_ZEBRA");var s=e.trim(o.val());if(a&&!t.HUB_SEARCH_SUBMIT){t.HUB_INSTANCE&&t.HUB_INSTANCE.intercept(s,function(e){t.HUB_SEARCH_SUBMIT=true;r.fire(n,"submit")});return false}return true})}},{ATTRS:{pluginId:{value:"hub"}}});function s(){var e=new i(location.href).getHostname();var a=new i(location.href).getPath();if(e==="www.tmall.com"&&(a==="/"||a==="")){return"home"}if(e==="list.tmall.com"){return"search"}if(e==="pre.wormhole.tmall.com"&&a==="/wow/portal/act/fp"){return"home"}return false}function u(){if(n.ie===7||n.ie===6||n.ipad){return false}return true}function c(){var e=new i(location.href).getQuery().get("hubdebug")||"";return e==="on"?true:false}return o},{requires:["dom","base","event","uri","ua"]});KISSY.add("mui/searchbar/template/act",function(e,t){var a={name:"act",text:"",promo:"49218",tpl:'<div class="{$prefixCls}mi-act" data-tpl="act" data-params="q={$query}&promo={promo}&type=p&xl={$wq}_1&from={$dim}_1_suggest">'+'<span class="{$prefixCls}mi-cont-key">{$query}</span>'+'<span class="{$prefixCls}mi-cont-text">\u5728<b>{text}</b>\u4e0b\u641c\u7d22</span>'+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugAct,option,suggest,{$pageType},{$isMobile}",parse:function(t,a,r){var i=r["$query"]||"";if(i==="undefined"||e.trim(i)===""||!this.text)return;r["text"]=this.text;r["promo"]=this.promo;var n=e.substitute(this.tpl,r);t.push({textContent:i,content:n})}};return a},{requires:["ajax"]});KISSY.add("mui/searchbar/template/shipShop",function(e){var t={name:"shipShop",tpl:'<div class="{$prefixCls}mi-ship" data-tpl="shipShop" data-index="0" data-params="q={$query}&type=2&style=w&xl={$wq}_2&from={$dim}_2_suggest">'+'<span class="{$prefixCls}mi-ship-wrap" data-url="{$shopUrl}"><img class="{$prefixCls}mi-ship-img" src="{$logo}"><span class="{$prefixCls}mi-ship-key">{$shopName}</span><i class="{$prefixCls}mi-ship-icon"></i></span>'+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugShop,{$userId},suggest,{$pageType},{$isMobile},2",parse:function(t,a,r){var i=r["$query"],n=this;if(i&&a["shop_info"]&&a["shop_info"].length){for(var s=0;s<a["shop_info"].length;s++){e.each(a["shop_info"][s],function(e,t){switch(t){case"shop_name":r["$shopName"]=e;break;case"logo":r["$logo"]="//img.alicdn.com/tfscom/"+e;break;case"shop_url":r["$shopUrl"]=e;break;default:}});r["$query"]=e.urlEncode(i);var o=e.substitute(n.tpl,r);t.push({textContent:i,content:o})}}}};return t});KISSY.add("mui/searchbar/template/cat",function(e,t){var a={name:"cat",tpl:'<div class="{$prefixCls}mi-cat" data-tpl="cat" data-index="{$index}" data-params="q={$2}&cat={$1}&type=p&xl={$wq}_{$index}&from={$dim}_1_suggest">'+'<span class="{$prefixCls}mi-cont-text">\u5728<b>{$0}</b>\u5206\u7c7b\u4e0b\u641c\u7d22</span>'+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugCat,{cat},suggest,{$pageType},{$isMobile}",parse:function(t,a,r){var i=a["cat"];if(a["tmall_noresult"]||!i||!e.isArray(i)||a.result.length<1)return;var n={textContent:"",content:'<div class="{$prefixCls}mi-cat" data-tpl="cat" data-index="0" data-params="q={$2}&type=p&xl={$wq}_{$index}&from={$dim}_1_suggest"><span class="{$prefixCls}mi-cont-key">{$2}</span></div>'};t.push(n);for(var o=0,s=Math.min(i.length,2),u="";o<s;o++){r["$index"]=1+o;var c=i[o];if(e.isArray(c)){for(var l=0;l<3;l++){r["$"+l]=c[l]||r["$query"]}}u=e.substitute(this.tpl,r);n.textContent=r["$2"];n.content=e.substitute(n.content,r);t.push({textContent:r["$2"],content:u})}t.push({content:'<div class="hr"/>',disabled:true})}};return a},{requires:["dom"]});KISSY.add("mui/searchbar/template/list",function(e){var t={name:"list",tpl:'<div class="{$prefixCls}mi-list" data-tpl="list" data-index="{$index}" data-params="q={$query}&type=p&xl={$wq}_{$index}&from={$dim}_1_suggest">'+'<span class="{$prefixCls}mi-cont-key">{text}</span>'+'<span class="{$prefixCls}mi-cont-count">\u7ea6{count}\u4e2a\u7ed3\u679c</span>'+'<a class="{$prefixCls}mi-btn-backfill" href="javascript:;">\u56de\u586b</a>'+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugQuery,query,suggest,{$pageType},{$isMobile}",parse:function(t,a,r){var i=this,n=r["$query"];a["tmall_noresult"]&&t.push({content:'<div class="'+r["$prefixCls"]+'mi-noresult-tip">\u56e7\uff0c\u60a8\u8f93\u5165\u7684\u5173\u952e\u8bcd\u4e0b\u6ca1\u6709\u7ed3\u679c\uff0c\u8bd5\u8bd5\u8fd9\u4e9b\u5427\uff1a</div>',disabled:true});e.each(a.result,function(o,s){if(!o||!o[0]){a.result.splice(s,1);return}for(var u in t){if(t[u].textContent===o[0])return}var c=o[0],l=n;if(!c.match(/\<(\/)?\w\>/gi)){while(c.indexOf(l)<0){l=l.substr(0,l.length-1)}var p=c.indexOf(l),m=p+l.length,d=c.substr(0,p),h=c.substr(m);d=d?"<b>"+d+"</b>":"";h=h?"<b>"+h+"</b>":"";c=d+l+h}r["$query"]=e.urlEncode(o[0].replace(/\<(\/)?\w\>/gi,""));r["$index"]=s+1;r["text"]=c;r["count"]=o[1];var f=e.substitute(i.tpl,r);t.push({textContent:e.urlDecode(r["$query"]),content:f})})}};return t});KISSY.add("mui/searchbar/template/shop",function(e){var t={name:"shop",tpl:'<div class="{$prefixCls}mi-tip" data-tpl="shop" data-params="q={$query}&type=p&style=w&xl={$wq}_2&from={$dim}_2_suggest">'+"<i></i>\u627e\u201c<b>{$text}</b>\u201d\u76f8\u5173<em>\u5e97\u94fa</em>"+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugShop,option,suggest,{$pageType}",parse:function(t,a,r){var i=r["$query"];if(e.trim(i)===""||i=="undefined")return;r["$query"]=e.urlEncode(i);r["$text"]=i;var n=e.substitute(this.tpl,r);t.push({textContent:i,content:n})}};return t});KISSY.add("mui/searchbar/template/quickSearch",function(e){var t={name:"quickSearch",tpl:'<p class="{$prefixCls}mi-qs"><i></i>\u6309\u5feb\u6377\u952e <em>shift</em> + <em>?</em> \u53ef\u4ee5\u968f\u65f6\u6253\u5f00\u5feb\u6377\u641c\u7d22\u6846\uff0c\u8d76\u7d27\u8bd5\u8bd5\u5427~</p>',parse:function(t,a,r){var i=r["$query"];if(e.trim(i)==="")return;var n=e.substitute(this.tpl,r);t.push({content:n,disabled:true})}};return t});KISSY.add("mui/searchbar/template/meetingPlace",function(e,t,a){function r(){var e=t.query("meta")||[];var a,r="0.0";for(a=0;a<e.length;a++){if(t.attr(e[a],"name")==="spm-id"){r=t.attr(e[a],"content");break}}return r}var i={name:"meetingPlace",tpl:'<div class="{$prefixCls}mi-meetingPC" data-tpl="meetingPlace" data-index="0" data-params="q={$query}&type=2&style=w&xl={$wq}_2&from={$dim}_2_suggest">'+'<a class="{$prefixCls}mi-meetingPC-wrap" target="_blank" href="{$actionUrl}"><img class="{$prefixCls}mi-meetingPC-img" src="{$imgUrl}"></a>'+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugShop,{$userId},suggest,{$pageType},{$isMobile},2",parse:function(t,i,n){var o=n["$query"],s=this;if(o&&i["banner"]&&i["banner"].length){for(var u=0;u<i["banner"].length;u++){e.each(i["banner"][u],function(e,t){switch(t){case"bannerText":n["$bannerText"]=e;break;case"imgUrl":n["$imgUrl"]=e;break;case"actionUrl":n["$actionUrl"]=e;break;default:}});n["$query"]=e.urlEncode(o);var l=n["$actionUrl"];try{var c=new a(n["$actionUrl"]);var p=r()+".banner.1";c.query&&c.query.add("spm",p);n["$actionUrl"]=c.toString(false)}catch(m){n["$actionUrl"]=l}var d=e.substitute(s.tpl,n);t.push({textContent:o,content:d})}}}};return i},{requires:["dom","uri"]});